<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>MDT - Sistema Médico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      margin: 0; padding: 20px;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    #particles-js {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: -1;
      background: #111;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: #222;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 15px #00faff88;
    }
    input, textarea, button {
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border-radius: 4px;
      border: none;
      font-size: 1em;
    }
    textarea {
      resize: vertical;
      height: 80px;
    }
    button {
      background: #00faff;
      color: #111;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background: #0088cc;
      color: #fff;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 250px;
      overflow-y: auto;
    }
    li {
      background: #333;
      margin-bottom: 10px;
      padding: 12px;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
    }
    .li-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      margin-bottom: 6px;
    }
    .btn-group button {
      margin-left: 6px;
      padding: 6px 10px;
      font-size: 0.9em;
      border-radius: 4px;
    }
    .hidden {
      display: none;
    }
    .admin-badge {
      color: #0ff;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>
  <div class="container">

    <!-- LOGIN -->
    <div id="loginDiv">
      <h2>Iniciar Sesión MDT</h2>
      <input type="text" id="inputNombre" placeholder="Nombre" />
      <input type="text" id="inputApellido" placeholder="Apellido" />
      <button id="btnLogin">Ingresar</button>
      <p id="loginError" style="color:#f55;"></p>
    </div>

    <!-- PANEL USUARIO -->
    <div id="panelUsuario" class="hidden">
      <h2>Bienvenido <span id="nombreUsuario"></span> <span id="adminBadge" class="admin-badge hidden">(Admin)</span></h2>

      <!-- Formulario para agregar registro -->
      <h3>Agregar registro de paciente</h3>
      <textarea id="datosPaciente" placeholder="Datos del paciente..."></textarea>
      <button id="btnAgregarRegistro">Agregar Registro</button>

      <!-- Lista de registros -->
      <h3>Registros MDT</h3>
      <ul id="listaRegistros"></ul>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
  <script>
    // Partículas
    tsParticles.load("particles-js", {
      particles: {
        number: { value: 60 },
        size: { value: 4 },
        color: { value: "#00faff" },
        move: { enable: true, speed: 2 },
        line_linked: { enable: true, distance: 100, color: "#fff" }
      }
    });

    // Admins (nombres completos en minúsculas)
    const admins = ["danilo isaias cuevas ibarra", "jefe samu", "alto mando especial"];

    // Variables globales
    let usuarioActual = null;
    let esAdmin = false;

    // DOM Elements
    const loginDiv = document.getElementById("loginDiv");
    const panelUsuario = document.getElementById("panelUsuario");
    const inputNombre = document.getElementById("inputNombre");
    const inputApellido = document.getElementById("inputApellido");
    const btnLogin = document.getElementById("btnLogin");
    const nombreUsuarioSpan = document.getElementById("nombreUsuario");
    const adminBadge = document.getElementById("adminBadge");
    const loginError = document.getElementById("loginError");

    const datosPaciente = document.getElementById("datosPaciente");
    const btnAgregarRegistro = document.getElementById("btnAgregarRegistro");
    const listaRegistros = document.getElementById("listaRegistros");

    // Función para iniciar sesión
    btnLogin.onclick = () => {
      const nombre = inputNombre.value.trim();
      const apellido = inputApellido.value.trim();
      if (!nombre || !apellido) {
        loginError.textContent = "Por favor ingresa nombre y apellido.";
        return;
      }
      loginError.textContent = "";
      usuarioActual = `${nombre.toLowerCase()} ${apellido.toLowerCase()}`;
      esAdmin = admins.includes(usuarioActual);
      mostrarPanelUsuario(nombre, apellido);
    };

    function mostrarPanelUsuario(nombre, apellido) {
      loginDiv.classList.add("hidden");
      panelUsuario.classList.remove("hidden");
      nombreUsuarioSpan.textContent = `${nombre} ${apellido}`;
      adminBadge.classList.toggle("hidden", !esAdmin);
      cargarRegistros();
    }

    // Guardar registro
    btnAgregarRegistro.onclick = () => {
      const texto = datosPaciente.value.trim();
      if (!texto) return alert("Debes ingresar los datos del paciente.");

      let registros = JSON.parse(localStorage.getItem("mdtRegistros")) || [];
      registros.push({
        nombreUsuario: usuarioActual,
        datosPaciente: texto,
        fecha: new Date().toLocaleString(),
        id: Date.now(),
        placa: "",
      });
      localStorage.setItem("mdtRegistros", JSON.stringify(registros));
      datosPaciente.value = "";
      cargarRegistros();
    };

    // Cargar y mostrar registros
    function cargarRegistros() {
      listaRegistros.innerHTML = "";
      let registros = JSON.parse(localStorage.getItem("mdtRegistros")) || [];

      registros.forEach((reg, i) => {
        const li = document.createElement("li");

        // Mostrar datos del paciente
        li.innerHTML = `
          <div class="li-header">
            <div>
              <strong>Paciente:</strong> ${reg.datosPaciente}<br/>
              <small>Registrado por: ${reg.nombreUsuario} - Fecha: ${reg.fecha}</small>
            </div>
            <div class="btn-group"></div>
          </div>
        `;

        // Si es admin, agregamos botones extra
        if (esAdmin) {
          const btnGroup = li.querySelector(".btn-group");

          // Botón borrar
          const btnBorrar = document.createElement("button");
          btnBorrar.textContent = "Borrar";
          btnBorrar.onclick = () => {
            if (confirm("¿Seguro quieres borrar este registro?")) {
              borrarRegistro(reg.id);
            }
          };
          btnGroup.appendChild(btnBorrar);

          // Botón editar placa
          const btnEditarPlaca = document.createElement("button");
          btnEditarPlaca.textContent = "Editar Placa";
          btnEditarPlaca.onclick = () => {
            const nuevaPlaca = prompt("Ingrese nueva placa:", reg.placa || "");
            if (nuevaPlaca !== null) {
              editarPlaca(reg.id, nuevaPlaca);
            }
          };
          btnGroup.appendChild(btnEditarPlaca);

          // Botón resetear placa
          const btnResetPlaca = document.createElement("button");
          btnResetPlaca.textContent = "Resetear Placa";
          btnResetPlaca.onclick = () => {
            if (confirm("¿Resetear placa a vacía?")) {
              editarPlaca(reg.id, "");
            }
          };
          btnGroup.appendChild(btnResetPlaca);

          // Mostrar placa actual
          const placaSpan = document.createElement("div");
          placaSpan.style.marginTop = "6px";
          placaSpan.innerHTML = `<strong>Placa:</strong> ${reg.placa || "(ninguna)"}`;
          li.appendChild(placaSpan);
        }

        listaRegistros.appendChild(li);
      });
    }

    // Función borrar registro por ID
    function borrarRegistro(id) {
      let registros = JSON.parse(localStorage.getItem("mdtRegistros")) || [];
      registros = registros.filter(r => r.id !== id);
      localStorage.setItem("mdtRegistros", JSON.stringify(registros));
      cargarRegistros();
    }

    // Función editar placa por ID
    function editarPlaca(id, nuevaPlaca) {
      let registros = JSON.parse(localStorage.getItem("mdtRegistros")) || [];
      const reg = registros.find(r => r.id === id);
      if (reg) {
        reg.placa = nuevaPlaca;
        localStorage.setItem("mdtRegistros", JSON.stringify(registros));
        cargarRegistros();
      }
    }
  </script>
</body>
</html>

