<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel SAMU Metropolitana</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="particles-js"></div>
  
  <!-- Perfil y dropdown -->
  <div class="profile-container">
    <img src="default.png" id="profilePic" class="profile-pic" alt="Perfil">
    <div id="profileDropdown" class="dropdown">
      <button onclick="changeTheme('light')">Modo Claro</button>
      <button onclick="changeTheme('dark')">Modo Oscuro</button>
      <button onclick="changeProfilePic()">Cambiar Imagen</button>
      <button class="logout" onclick="logout()">Cerrar Sesión</button>
    </div>
  </div>

  <!-- Contenido Principal -->
  <div class="container">
    <!-- Inicio de Sesión -->
    <div class="formulario" id="loginForm">
      <h2>Iniciar Sesión</h2>
      <input type="text" id="username" placeholder="Nombre de usuario">
      <input type="text" id="placa" placeholder="Placa">
      <button onclick="login()">Iniciar Sesión</button>
    </div>

    <!-- Formulario Paciente -->
    <div class="formulario" id="pacienteForm" style="display:none;">
      <h2>Registrar Paciente</h2>
      <input type="text" id="nombrePaciente" placeholder="Nombre del paciente">
      <input type="text" id="apellidoPaciente" placeholder="Apellido del paciente">
      <input type="text" id="rutPaciente" placeholder="RUT">
      <input type="text" id="motivo" placeholder="Motivo de atención">
      <button onclick="registrarPaciente()">Registrar</button>
    </div>

    <!-- Registros -->
    <div class="registros">
      <h2>Registros</h2>
      <ul id="listaPacientes"></ul>
    </div>
  </div>

  <!-- Script completo -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js"></script>
  <script>
    // Inicializar Partículas
    particlesJS.load('particles-js', 'https://cdn.jsdelivr.net/gh/VincentGarreau/particles.js/particles.json');

    // Usuarios admin definidos
    const admins = ['Danilo', 'Carlos'];

    // Al cargar la página
    window.onload = () => {
      const usuario = localStorage.getItem('usuario');
      const placa = localStorage.getItem('placa');
      const imagen = localStorage.getItem('imagen');
      if (usuario && placa) {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('pacienteForm').style.display = 'block';
        document.getElementById('profilePic').src = imagen || 'default.png';
        if (admins.includes(usuario)) document.body.classList.add('admin-border');
        mostrarPacientes();
      }
    };

    // Iniciar sesión
    function login() {
      const usuario = document.getElementById('username').value;
      const placa = document.getElementById('placa').value;
      if (!usuario || !placa) return alert('Completa todos los campos');
      localStorage.setItem('usuario', usuario);
      localStorage.setItem('placa', placa);
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('pacienteForm').style.display = 'block';
      if (admins.includes(usuario)) document.body.classList.add('admin-border');
      mostrarPacientes();
    }

    // Registrar paciente
    function registrarPaciente() {
      const nombre = document.getElementById('nombrePaciente').value;
      const apellido = document.getElementById('apellidoPaciente').value;
      const rut = document.getElementById('rutPaciente').value;
      const motivo = document.getElementById('motivo').value;
      if (!nombre || !apellido || !rut || !motivo) return alert('Completa todo');
      const pacientes = JSON.parse(localStorage.getItem('pacientes') || '[]');
      pacientes.push({ nombre, apellido, rut, motivo });
      localStorage.setItem('pacientes', JSON.stringify(pacientes));
      mostrarPacientes();
    }

    // Mostrar pacientes
    function mostrarPacientes() {
      const lista = document.getElementById('listaPacientes');
      lista.innerHTML = '';
      const pacientes = JSON.parse(localStorage.getItem('pacientes') || '[]');
      pacientes.forEach((p, i) => {
        const li = document.createElement('li');
        li.textContent = `${p.nombre} ${p.apellido} (${p.rut}) - ${p.motivo}`;
        if (admins.includes(localStorage.getItem('usuario'))) {
          const btn = document.createElement('button');
          btn.textContent = 'Eliminar';
          btn.onclick = () => eliminarPaciente(i);
          li.appendChild(btn);
        }
        lista.appendChild(li);
      });
    }

    function eliminarPaciente(i) {
      const pacientes = JSON.parse(localStorage.getItem('pacientes'));
      pacientes.splice(i, 1);
      localStorage.setItem('pacientes', JSON.stringify(pacientes));
      mostrarPacientes();
    }

    function logout() {
      localStorage.removeItem('usuario');
      localStorage.removeItem('placa');
      location.reload();
    }

    function changeTheme(theme) {
      document.body.className = theme === 'light' ? 'theme-light' : 'theme-dark';
      localStorage.setItem('theme', theme);
    }

    function changeProfilePic() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = () => {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = e => {
            const dataURL = e.target.result;
            localStorage.setItem('imagen', dataURL);
            document.getElementById('profilePic').src = dataURL;
          };
          reader.readAsDataURL(file);
        }
      };
      input.click();
    }

    document.getElementById('profilePic').onclick = () => {
      document.getElementById('profileDropdown').classList.toggle('active');
    };
  </script>
</body>
</html>
